<!doctype html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Gestión de Usuarios | FMH UNACH</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="title" content="Gestión de Usuarios | FMH UNACH" />
    <meta name="description" content="Panel de administración para gestionar usuarios del sistema" />
    
    <!--begin::Fonts-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />
    <!--end::Fonts-->
    
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css" integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg=" crossorigin="anonymous" />
    <!--end::Third Party Plugin(OverlayScrollbars)-->
    
    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />
    <!--end::Third Party Plugin(Bootstrap Icons)-->
    
    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="../../../dist/css/adminlte.css" />
    <!--end::Required Plugin(AdminLTE)-->
    
    <meta charset="UTF-8" />
  </head>
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
      <!--begin::Header-->
      <nav class="app-header navbar navbar-expand" style="background-color: #192d63">
        <div class="container-fluid">
          <div class="d-flex align-items-center w-100">
            <img src="../../../dist/img/logo-unach-azul.png" alt="Logo UNACH" style="max-width: 48px; margin-right: 16px" />
            <div class="flex-grow-1 text-center">
              <span class="fw-bold" style="color: #d4b012; font-size: 1.3rem">Facultad de Medicina Humana "Dr. Manuel Velasco Suárez"</span><br />
              <span class="fw-light text-white" style="font-size: 1rem">Educación que transforma</span>
            </div>
            <div class="d-flex align-items-center">
              <a href="../../../dist/pages/admin/login.html" class="btn btn-outline-light btn-sm me-2" style="border-color: #d4b012; color: #d4b012">
                <i class="bi bi-shield-lock me-1"></i>Administración
              </a>
              <img src="../../../dist/img/jubileo50.png" alt="Jubileo 50 años" style="max-width: 48px; margin-left: 16px" />
            </div>
          </div>
        </div>
      </nav>
      <!--end::Header-->
      
      <!--begin::Sidebar-->
      <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark" style="background-color: #192d63">
        <!--begin::Sidebar Brand-->
        <div class="sidebar-brand">
          <a href="/admin/dashboard" class="brand-link">
            <img src="../../../dist/img/logo-unach-azul.png" alt="Logo UNACH" class="brand-image opacity-75 shadow" />
            <span class="brand-text fw-bold" style="color: #d4b012">ADMIN UNACH</span>
          </a>
        </div>
        <!--end::Sidebar Brand-->
        
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <ul class="nav sidebar-menu flex-column" role="menu">
              <li class="nav-item">
                <a href="/admin/dashboard" class="nav-link">
                  <i class="nav-icon bi bi-speedometer2" style="color: #d4b012"></i>
                  <p>Dashboard</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/quejas" class="nav-link">
                  <i class="nav-icon bi bi-exclamation-triangle-fill" style="color: #d4b012"></i>
                  <p>Gestión de Quejas</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/sugerencias" class="nav-link">
                  <i class="nav-icon bi bi-lightbulb-fill" style="color: #d4b012"></i>
                  <p>Gestión de Sugerencias</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/reconocimientos" class="nav-link">
                  <i class="nav-icon bi bi-star-fill" style="color: #d4b012"></i>
                  <p>Gestión de Reconocimientos</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/usuarios" class="nav-link active">
                  <i class="nav-icon bi bi-people-fill" style="color: #d4b012"></i>
                  <p>Gestión de Usuarios</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/reportes" class="nav-link">
                  <i class="nav-icon bi bi-graph-up" style="color: #d4b012"></i>
                  <p>Reportes y Estadísticas</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="/admin/configuracion" class="nav-link">
                  <i class="nav-icon bi bi-gear-fill" style="color: #d4b012"></i>
                  <p>Configuración</p>
                </a>
              </li>
              <hr style="border-color: #d4b012; opacity: 0.3" />
              <li class="nav-item">
                <a href="/" class="nav-link">
                  <i class="nav-icon bi bi-house-door-fill" style="color: #d4b012"></i>
                  <p>Volver al Sitio</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" id="logoutBtn">
                  <i class="nav-icon bi bi-box-arrow-right" style="color: #d4b012"></i>
                  <p>Cerrar Sesión</p>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </aside>
      <!--end::Sidebar-->
      
      <main class="app-main">
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-md-2 text-center mb-2 mb-md-0">
                <img src="/dist/img/logo-unach-azul.png" alt="Logo UNACH" style="max-width: 100px" />
              </div>
              <div class="col-md-8 text-center">
                <h2 class="mb-0">Gestión de Usuarios</h2>
                <h5>Facultad de Medicina Humana "Dr. Manuel Velasco Suárez" Campus IV</h5>
              </div>
              <div class="col-md-2 text-center mb-2 mb-md-0">
                <img src="/dist/img/jubileo50.png" alt="Jubileo 50 años" style="max-width: 100px" />
              </div>
            </div>
          </div>
        </div>
        
        <div class="app-content">
          <div class="container-fluid">
            <!-- Filtros y Búsqueda -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Buscar usuarios..." id="searchInput">
                  <button class="btn btn-outline-secondary" type="button" id="searchBtn">
                    <i class="bi bi-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="roleFilter">
                  <option value="">Todos los roles</option>
                  <option value="Administrador">Administrador</option>
                  <option value="Docente">Docente</option>
                  <option value="Estudiante">Estudiante</option>
                  <option value="Personal Administrativo">Personal Administrativo</option>
                  <option value="Invitado">Invitado</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="statusFilter">
                  <option value="">Todos los estados</option>
                  <option value="Activo">Activo</option>
                  <option value="Inactivo">Inactivo</option>
                  <option value="Suspendido">Suspendido</option>
                </select>
              </div>
            </div>
            
            <!-- Estadísticas Rápidas -->
            <div class="row g-4 mb-4">
              <div class="col-xl-3 col-md-6">
                <div class="card bg-primary text-white">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div>
                        <h3 class="mb-0" id="totalUsuarios">0</h3>
                        <p class="mb-0">Total Usuarios</p>
                      </div>
                      <div class="align-self-center">
                        <i class="bi bi-people-fill fs-1"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-md-6">
                <div class="card bg-success text-white">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div>
                        <h3 class="mb-0" id="usuariosActivos">0</h3>
                        <p class="mb-0">Usuarios Activos</p>
                      </div>
                      <div class="align-self-center">
                        <i class="bi bi-check-circle-fill fs-1"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-md-6">
                <div class="card bg-warning text-white">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div>
                        <h3 class="mb-0" id="usuariosInactivos">0</h3>
                        <p class="mb-0">Usuarios Inactivos</p>
                      </div>
                      <div class="align-self-center">
                        <i class="bi bi-pause-circle-fill fs-1"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-md-6">
                <div class="card bg-info text-white">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div>
                        <h3 class="mb-0" id="nuevosUsuarios">0</h3>
                        <p class="mb-0">Nuevos este mes</p>
                      </div>
                      <div class="align-self-center">
                        <i class="bi bi-person-plus-fill fs-1"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Tabla de Usuarios -->
            <div class="card">
              <div class="card-header">
                <h5 class="card-title">Lista de Usuarios</h5>
                <div class="card-tools">
                  <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addUsuarioModal">
                    <i class="bi bi-plus-circle me-1"></i>Nuevo Usuario
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped" id="usuariosTable">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Último Acceso</th>
                        <th>Fecha Creación</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="usuariosTableBody">
                      <!-- Se llenará dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      
      <!--begin::Footer-->
      <footer class="app-footer" style="background-color: #192d63; color: #d4b012; padding: 1rem 0">
        <div class="container-fluid text-center">
          <strong>
            &copy; 2025 Facultad de Medicina Humana "Dr. Manuel Velasco Suárez" - UNACH.<br />
            Carretera Puerto Madero Km. 10.5, Finca Santa Teresa, Tapachula, Chiapas, México | C.P.
            30825 | Tel: (961) 6178000 ext. 5695
          </strong>
          <div style="font-size: 0.9rem; color: #fff">Todos los derechos reservados.</div>
        </div>
      </footer>
      <!--end::Footer-->
    </div>
    
    <!-- Modal para Nuevo Usuario -->
    <div class="modal fade" id="addUsuarioModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Nuevo Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="addUsuarioForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" class="form-control" id="nombre" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Usuario</label>
                    <input type="text" class="form-control" id="username" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-control" id="password" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Rol</label>
                    <select class="form-select" id="rol" required>
                      <option value="">Seleccionar rol</option>
                      <option value="Administrador">Administrador</option>
                      <option value="Docente">Docente</option>
                      <option value="Estudiante">Estudiante</option>
                      <option value="Personal Administrativo">Personal Administrativo</option>
                      <option value="Invitado">Invitado</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <select class="form-select" id="estado" required>
                      <option value="Activo">Activo</option>
                      <option value="Inactivo">Inactivo</option>
                      <option value="Suspendido">Suspendido</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Departamento/Área</label>
                <input type="text" class="form-control" id="departamento" placeholder="Opcional">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="saveUsuarioBtn">Guardar Usuario</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal para Ver/Editar Usuario -->
    <div class="modal fade" id="editUsuarioModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="editUsuarioForm">
              <input type="hidden" id="editId">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" class="form-control" id="editNombre" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="editEmail" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Usuario</label>
                    <input type="text" class="form-control" id="editUsername" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Nueva Contraseña</label>
                    <input type="password" class="form-control" id="editPassword" placeholder="Dejar en blanco para mantener la actual">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Rol</label>
                    <select class="form-select" id="editRol" required>
                      <option value="Administrador">Administrador</option>
                      <option value="Docente">Docente</option>
                      <option value="Estudiante">Estudiante</option>
                      <option value="Personal Administrativo">Personal Administrativo</option>
                      <option value="Invitado">Invitado</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <select class="form-select" id="editEstado" required>
                      <option value="Activo">Activo</option>
                      <option value="Inactivo">Inactivo</option>
                      <option value="Suspendido">Suspendido</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Departamento/Área</label>
                <input type="text" class="form-control" id="editDepartamento">
              </div>
              <div class="mb-3">
                <label class="form-label">Comentarios del Administrador</label>
                <textarea class="form-control" id="editComentarios" rows="3" placeholder="Agregar comentarios sobre el usuario..."></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="updateUsuarioBtn">Actualizar Usuario</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script src="../../../dist/js/adminlte.js"></script>
    
    <script>
      // Verificar autenticación
      if (!localStorage.getItem('adminLoggedIn')) {
        window.location.href = 'login.html';
      }
      
      // Datos simulados de usuarios
      let usuarios = [
        {
          id: 1,
          nombre: 'Dr. Carlos García',
          email: 'carlos.garcia@unach.mx',
          username: 'cgarcia',
          rol: 'Docente',
          estado: 'Activo',
          departamento: 'Medicina Interna',
          ultimoAcceso: '2024-01-20 14:30',
          fechaCreacion: '2023-08-15',
          comentarios: ''
        },
        {
          id: 2,
          nombre: 'María Elena López',
          email: 'maria.lopez@unach.mx',
          username: 'mlopez',
          rol: 'Estudiante',
          estado: 'Activo',
          departamento: 'Medicina General',
          ultimoAcceso: '2024-01-20 16:45',
          fechaCreacion: '2023-09-01',
          comentarios: ''
        },
        {
          id: 3,
          nombre: 'Lic. Roberto Martínez',
          email: 'roberto.martinez@unach.mx',
          username: 'rmartinez',
          rol: 'Personal Administrativo',
          estado: 'Activo',
          departamento: 'Secretaría Académica',
          ultimoAcceso: '2024-01-20 12:15',
          fechaCreacion: '2023-07-20',
          comentarios: ''
        },
        {
          id: 4,
          nombre: 'Admin Sistema',
          email: 'admin@unach.mx',
          username: 'admin',
          rol: 'Administrador',
          estado: 'Activo',
          departamento: 'Sistemas',
          ultimoAcceso: '2024-01-20 18:00',
          fechaCreacion: '2023-01-01',
          comentarios: 'Usuario administrador del sistema'
        }
      ];
      
      // Función para renderizar la tabla
      function renderUsuarios(data = usuarios) {
        const tbody = document.getElementById('usuariosTableBody');
        tbody.innerHTML = '';
        
        data.forEach(usuario => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${usuario.id}</td>
            <td>${usuario.nombre}</td>
            <td>${usuario.email}</td>
            <td><span class="badge ${getRolBadgeClass(usuario.rol)}">${usuario.rol}</span></td>
            <td><span class="badge ${getEstadoBadgeClass(usuario.estado)}">${usuario.estado}</span></td>
            <td>${usuario.ultimoAcceso}</td>
            <td>${usuario.fechaCreacion}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="viewUsuario(${usuario.id})">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn btn-sm btn-success" onclick="editUsuario(${usuario.id})">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-warning" onclick="toggleUsuario(${usuario.id})">
                <i class="bi bi-power"></i>
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteUsuario(${usuario.id})">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
        
        updateStats();
      }
      
      // Función para obtener clase del badge de rol
      function getRolBadgeClass(rol) {
        switch(rol) {
          case 'Administrador': return 'bg-danger';
          case 'Docente': return 'bg-primary';
          case 'Estudiante': return 'bg-success';
          case 'Personal Administrativo': return 'bg-info';
          case 'Invitado': return 'bg-secondary';
          default: return 'bg-secondary';
        }
      }
      
      // Función para obtener clase del badge de estado
      function getEstadoBadgeClass(estado) {
        switch(estado) {
          case 'Activo': return 'bg-success';
          case 'Inactivo': return 'bg-warning';
          case 'Suspendido': return 'bg-danger';
          default: return 'bg-secondary';
        }
      }
      
      // Función para actualizar estadísticas
      function updateStats() {
        document.getElementById('totalUsuarios').textContent = usuarios.length;
        document.getElementById('usuariosActivos').textContent = usuarios.filter(u => u.estado === 'Activo').length;
        document.getElementById('usuariosInactivos').textContent = usuarios.filter(u => u.estado === 'Inactivo').length;
        
        // Usuarios nuevos este mes (simulado)
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        const nuevosUsuarios = usuarios.filter(u => {
          const userDate = new Date(u.fechaCreacion);
          return userDate.getMonth() === currentMonth && userDate.getFullYear() === currentYear;
        }).length;
        document.getElementById('nuevosUsuarios').textContent = nuevosUsuarios;
      }
      
      // Función para ver usuario
      function viewUsuario(id) {
        const usuario = usuarios.find(u => u.id === id);
        if (usuario) {
          alert(`Viendo usuario: ${usuario.nombre}\n\nEmail: ${usuario.email}\nUsuario: ${usuario.username}\nRol: ${usuario.rol}\nEstado: ${usuario.estado}\nDepartamento: ${usuario.departamento}`);
        }
      }
      
      // Función para editar usuario
      function editUsuario(id) {
        const usuario = usuarios.find(u => u.id === id);
        if (usuario) {
          document.getElementById('editId').value = usuario.id;
          document.getElementById('editNombre').value = usuario.nombre;
          document.getElementById('editEmail').value = usuario.email;
          document.getElementById('editUsername').value = usuario.username;
          document.getElementById('editPassword').value = '';
          document.getElementById('editRol').value = usuario.rol;
          document.getElementById('editEstado').value = usuario.estado;
          document.getElementById('editDepartamento').value = usuario.departamento;
          document.getElementById('editComentarios').value = usuario.comentarios;
          
          const modal = new bootstrap.Modal(document.getElementById('editUsuarioModal'));
          modal.show();
        }
      }
      
      // Función para cambiar estado del usuario
      function toggleUsuario(id) {
        const usuario = usuarios.find(u => u.id === id);
        if (usuario) {
          const nuevoEstado = usuario.estado === 'Activo' ? 'Inactivo' : 'Activo';
          usuario.estado = nuevoEstado;
          renderUsuarios();
          alert(`Usuario ${usuario.nombre} ${nuevoEstado === 'Activo' ? 'activado' : 'desactivado'} exitosamente`);
        }
      }
      
      // Función para eliminar usuario
      function deleteUsuario(id) {
        const usuario = usuarios.find(u => u.id === id);
        if (usuario && usuario.rol === 'Administrador') {
          alert('No se puede eliminar un usuario administrador');
          return;
        }
        
        if (confirm(`¿Estás seguro de que quieres eliminar al usuario ${usuario.nombre}?`)) {
          usuarios = usuarios.filter(u => u.id !== id);
          renderUsuarios();
        }
      }
      
      // Función para guardar nuevo usuario
      document.getElementById('saveUsuarioBtn').addEventListener('click', function() {
        const form = document.getElementById('addUsuarioForm');
        if (form.checkValidity()) {
          const nuevoUsuario = {
            id: usuarios.length + 1,
            nombre: document.getElementById('nombre').value,
            email: document.getElementById('email').value,
            username: document.getElementById('username').value,
            rol: document.getElementById('rol').value,
            estado: document.getElementById('estado').value,
            departamento: document.getElementById('departamento').value,
            ultimoAcceso: new Date().toLocaleString('es-MX'),
            fechaCreacion: new Date().toISOString().split('T')[0],
            comentarios: ''
          };
          
          usuarios.push(nuevoUsuario);
          renderUsuarios();
          
          // Limpiar formulario y cerrar modal
          form.reset();
          const modal = bootstrap.Modal.getInstance(document.getElementById('addUsuarioModal'));
          modal.hide();
          
          alert('Usuario guardado exitosamente');
        } else {
          form.reportValidity();
        }
      });
      
      // Función para actualizar usuario
      document.getElementById('updateUsuarioBtn').addEventListener('click', function() {
        const form = document.getElementById('editUsuarioForm');
        if (form.checkValidity()) {
          const id = parseInt(document.getElementById('editId').value);
          const index = usuarios.findIndex(u => u.id === id);
          
          if (index !== -1) {
            usuarios[index] = {
              ...usuarios[index],
              nombre: document.getElementById('editNombre').value,
              email: document.getElementById('editEmail').value,
              username: document.getElementById('editUsername').value,
              rol: document.getElementById('editRol').value,
              estado: document.getElementById('editEstado').value,
              departamento: document.getElementById('editDepartamento').value,
              comentarios: document.getElementById('editComentarios').value
            };
            
            // Si se cambió la contraseña
            const nuevaPassword = document.getElementById('editPassword').value;
            if (nuevaPassword) {
              // En un sistema real, aquí se hashearía la contraseña
              usuarios[index].passwordChanged = true;
            }
            
            renderUsuarios();
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editUsuarioModal'));
            modal.hide();
            
            alert('Usuario actualizado exitosamente');
          }
        } else {
          form.reportValidity();
        }
      });
      
      // Función de búsqueda
      document.getElementById('searchBtn').addEventListener('click', function() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filtered = usuarios.filter(u => 
          u.nombre.toLowerCase().includes(searchTerm) ||
          u.email.toLowerCase().includes(searchTerm) ||
          u.username.toLowerCase().includes(searchTerm) ||
          u.departamento.toLowerCase().includes(searchTerm)
        );
        renderUsuarios(filtered);
      });
      
      // Filtro por rol
      document.getElementById('roleFilter').addEventListener('change', function() {
        const role = this.value;
        const filtered = role ? usuarios.filter(u => u.rol === role) : usuarios;
        renderUsuarios(filtered);
      });
      
      // Filtro por estado
      document.getElementById('statusFilter').addEventListener('change', function() {
        const status = this.value;
        const filtered = status ? usuarios.filter(u => u.estado === status) : usuarios;
        renderUsuarios(filtered);
      });
      
      // Función de logout
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
          localStorage.removeItem('adminLoggedIn');
          localStorage.removeItem('adminUser');
          window.location.href = 'login.html';
        }
      });
      
      // Inicializar la página
      document.addEventListener('DOMContentLoaded', function() {
        renderUsuarios();
      });
    </script>
  </body>
</html>
