localStorage.getItem("adminLoggedIn")||(window.location.href="login.html");let u={quejas:[{folio:"QJ-2024-001",fecha:"2024-01-20",remitente:"Anónimo",asunto:"Problema con el aire acondicionado",estado:"resuelto",prioridad:"alta",diasTranscurridos:3,satisfaccion:"muy_satisfecho"},{folio:"QJ-2024-002",fecha:"2024-01-19",remitente:"Carlos Ruiz",asunto:"Falta de material en laboratorio",estado:"en_proceso",prioridad:"alta",diasTranscurridos:5,satisfaccion:"satisfecho"},{folio:"QJ-2024-003",fecha:"2024-01-18",remitente:"María López",asunto:"Problema de conectividad WiFi",estado:"pendiente",prioridad:"media",diasTranscurridos:7,satisfaccion:"insatisfecho"}],sugerencias:[{folio:"SG-2024-001",fecha:"2024-01-20",remitente:"Ana Martínez",asunto:"Mejora en la biblioteca",estado:"aprobada",prioridad:"media",diasTranscurridos:2,satisfaccion:"muy_satisfecho"},{folio:"SG-2024-002",fecha:"2024-01-19",remitente:"Roberto Silva",asunto:"Nuevos horarios de consulta",estado:"en_revision",prioridad:"alta",diasTranscurridos:4,satisfaccion:"satisfecho"}],reconocimientos:[{folio:"RC-2024-001",fecha:"2024-01-20",remitente:"Dr. García",asunto:"Excelente atención del Dr. Hernández",estado:"publicado",prioridad:"baja",diasTranscurridos:1,satisfaccion:"muy_satisfecho"}]};document.addEventListener("DOMContentLoaded",function(){m(),f()});function m(){document.getElementById("generarReporteBtn").addEventListener("click",f),document.getElementById("exportarExcelBtn").addEventListener("click",M)}function f(){const o=document.getElementById("fechaDesde").value,e=document.getElementById("fechaHasta").value,t=document.getElementById("tipoReporte").value;let n=h(o,e,t);p(n),b(n),C(n),B(n),T(n)}function h(o,e,t){let n=[];return(t==="general"||t==="quejas")&&(n=n.concat(u.quejas)),(t==="general"||t==="sugerencias")&&(n=n.concat(u.sugerencias)),(t==="general"||t==="reconocimientos")&&(n=n.concat(u.reconocimientos)),n}function p(o){const e=o.length,t=o.filter(a=>a.estado==="resuelto"||a.estado==="publicado").length,n=o.filter(a=>a.estado==="en_proceso"||a.estado==="en_revision").length,s=o.length>0?Math.round(o.reduce((a,c)=>a+c.diasTranscurridos,0)/o.length):0;document.getElementById("totalEntradas").textContent=e,document.getElementById("resueltas").textContent=t,document.getElementById("enProceso").textContent=n,document.getElementById("tiempoPromedio").textContent=s}function b(o){E(o),y(o),x(o)}function E(o){const e=document.getElementById("tipoChart").getContext("2d");e.clearRect(0,0,400,300);const t={};o.forEach(c=>{const i=c.folio.substring(0,2);t[i]=(t[i]||0)+1});const n=["#FF6384","#36A2EB","#FFCE56","#4BC0C0"];let s=0,a=0;Object.entries(t).forEach(([c,i])=>{const l=i/o.length*100/100*2*Math.PI;e.beginPath(),e.moveTo(200,150),e.arc(200,150,80,s,s+l),e.closePath(),e.fillStyle=n[a%n.length],e.fill(),e.fillStyle="#000",e.font="12px Arial";const d=200+Math.cos(s+l/2)*100,g=150+Math.sin(s+l/2)*100;e.fillText(`${c}: ${i}`,d,g),s+=l,a++})}function y(o){const e=document.getElementById("tendenciaChart").getContext("2d");e.clearRect(0,0,400,300);const t={};o.forEach(a=>{const c=a.fecha;t[c]=(t[c]||0)+1});const n=Object.keys(t).sort(),s=Math.max(...Object.values(t));e.strokeStyle="#36A2EB",e.lineWidth=2,e.beginPath(),n.forEach((a,c)=>{const i=50+c*300/(n.length-1),r=250-t[a]/s*200;c===0?e.moveTo(i,r):e.lineTo(i,r)}),e.stroke(),e.fillStyle="#000",e.font="10px Arial",n.forEach((a,c)=>{const i=50+c*300/(n.length-1),r=250-t[a]/s*200;e.fillText(t[a],i,r-10)})}function x(o){const e=document.getElementById("estadoChart").getContext("2d");e.clearRect(0,0,800,300);const t={};o.forEach(c=>{t[c.estado]=(t[c.estado]||0)+1});const n=Object.keys(t),s=Math.max(...Object.values(t)),a=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF"];n.forEach((c,i)=>{const r=100+i*600/(n.length-1),l=t[c]/s*200,d=250-l;e.fillStyle=a[i%a.length],e.fillRect(r-30,d,60,l),e.fillStyle="#000",e.font="12px Arial",e.textAlign="center",e.fillText(t[c],r,d-10),e.fillText(c,r,270)})}function C(o){const e=document.getElementById("reporteTableBody");e.innerHTML="",o.forEach(t=>{const n=document.createElement("tr");n.innerHTML=`
            <td>${t.folio}</td>
            <td>${t.fecha}</td>
            <td><span class="badge ${v(t.folio)}">${I(t.folio)}</span></td>
            <td>${t.remitente}</td>
            <td>${t.asunto}</td>
            <td><span class="badge ${L(t.estado)}">${j(t.estado)}</span></td>
            <td>${t.diasTranscurridos}</td>
            <td><span class="badge ${S(t.prioridad)}">${t.prioridad}</span></td>
          `,e.appendChild(n)})}function B(o){const e=o.filter(i=>i.satisfaccion==="muy_satisfecho").length,t=o.filter(i=>i.satisfaccion==="satisfecho").length,n=o.filter(i=>i.satisfaccion==="insatisfecho").length,s=o.length,a=s>0?Math.round((e+t)/s*100):0;document.getElementById("muySatisfecho").textContent=e,document.getElementById("satisfecho").textContent=t,document.getElementById("insatisfecho").textContent=n;const c=document.getElementById("satisfaccionBar");c.style.width=a+"%",c.textContent=a+"%"}function T(o){const e={};o.forEach(s=>{let a="General";s.asunto.toLowerCase().includes("laboratorio")?a="Laboratorio":s.asunto.toLowerCase().includes("biblioteca")?a="Biblioteca":s.asunto.toLowerCase().includes("wifi")||s.asunto.toLowerCase().includes("conectividad")?a="Tecnología":(s.asunto.toLowerCase().includes("aire")||s.asunto.toLowerCase().includes("clima"))&&(a="Mantenimiento"),e[a]=(e[a]||0)+1});const t=Object.entries(e).sort(([,s],[,a])=>a-s).slice(0,5),n=document.getElementById("topAreas");n.innerHTML="",t.forEach(([s,a],c)=>{const i=document.createElement("div");i.className="d-flex justify-content-between align-items-center mb-2",i.innerHTML=`
            <span class="badge bg-primary">${c+1}</span>
            <span>${s}</span>
            <span class="badge bg-secondary">${a}</span>
          `,n.appendChild(i)})}function v(o){const e=o.substring(0,2);return{QJ:"bg-danger",SG:"bg-success",RC:"bg-warning"}[e]||"bg-secondary"}function I(o){const e=o.substring(0,2);return{QJ:"Queja",SG:"Sugerencia",RC:"Reconocimiento"}[e]||e}function L(o){return{pendiente:"bg-warning",en_proceso:"bg-info",en_revision:"bg-info",resuelto:"bg-success",aprobada:"bg-success",publicado:"bg-primary"}[o]||"bg-secondary"}function j(o){return{pendiente:"Pendiente",en_proceso:"En Proceso",en_revision:"En Revisión",resuelto:"Resuelto",aprobada:"Aprobada",publicado:"Publicado"}[o]||o}function S(o){return{baja:"bg-success",media:"bg-warning",alta:"bg-danger"}[o]||"bg-secondary"}function M(){alert("Función de exportación a Excel implementada. En producción, esto generaría un archivo .xlsx con todos los datos del reporte.")}
